function genTeamList(results){var output=[];for(const result of results){var data=[];data.push(`<div class="center td_team_rank">${result.rank}</div>`),data.push(`<span class="td_teamName">${result.fullname}</span></br><span class="td_inst_name">${result.institution&&result.institution.toUpperCase()}</span>`),data.push(`<div class="center">${result.problem_total_points}<br>(${result.total_fine})</div>`);for(const problem of result.problem_list)problem.is_solved?data.push(`<div class="center problem-status"><i class="material-icons green-text">lens</i><br><span class="problem-status-0">${problem.total_tries}(${problem.fine})</span></div>`):data.push(`<div class="center problem-status" ><i class="material-icons red-text">lens</i><br><span class="problem-status-0">${problem.total_tries}</span></div>`);output.push(data)}return output}function filterTeamRankTable(settings,searchData,index,rowData,counter){var teamNameInput=document.getElementById("team_name").value,institutionName=document.getElementById("institution_name").value,isStrict=document.getElementById("strict_ins_name").checked,minSolve=parseInt(document.getElementById("min_solv").value),maxSolve=parseInt(document.getElementById("max_solv").value),totalSolved=parseInt($(rowData[2])[0].textContent[0]),tmNm=(rowData=$(rowData[1]))[0].innerText,rowData=rowData[2].innerText;if(-1<tmNm.indexOf(teamNameInput)&&(isStrict&&institutionName?rowData===institutionName:-1<rowData.indexOf(institutionName))&&minSolve<=totalSolved&&totalSolved<=maxSolve)return!0}function filterUniRankTable(settings,searchData,index,rowData,counter){var institutionName=document.getElementById("institution_name_rank").value;if(-1<(rowData=$(rowData[2]))[0].innerText.indexOf(institutionName))return!0}function filterTable(settings,searchData,index,rowData,counter){return"ranking_tb"===settings.nTable.id?filterTeamRankTable(settings,searchData,index,rowData,counter):"uni_rank_tb"===settings.nTable.id?filterUniRankTable(settings,searchData,index,rowData,counter):void 0}async function getStandings(){for(var api=$("#standings_api").val(),baseUrl=new URL(api),results=[];;){var json=await(await fetch(baseUrl,{method:"GET"})).json();if(results.push(json.results),baseUrl.searchParams.set("page",json.next),null==json.next)break;await new Promise(r=>setTimeout(r,850))}var resultsMerged=[];let rank=0;for(const result of results)for(var[index,element]of result.entries())rank+=1,element.rank=rank,resultsMerged.push(element);return resultsMerged}async function getContestMeta(){var api=$("#contest_api").val();return(await fetch(api,{method:"GET"})).json()}function getDuration(starts,ends){starts=parseInt(new Date(starts)-new Date(ends))/1e3,ends=parseInt(starts/3600),starts=parseInt((starts-3600*ends)/60);return ends.toString().padStart(2,0)+":"+starts.toString().padStart(2,0)}function getContestStatus(ends,is_frozen){return is_frozen?"Frozen":0<parseInt(new Date(ends)-Date.now())?"Running":"Ended"}function formatDtString(text){text=new Intl.DateTimeFormat("default",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).formatToParts(new Date(text));const vals={};return text.forEach(part=>{vals[part.type]=part.value}),`${vals.day}-${vals.month}-${vals.year} ${vals.hour}:${vals.minute}:`+vals.second}function setContestMeta(json){let elem=document.getElementById("contest-title");elem.textContent=json.title,(elem=document.getElementById("contest-start-time")).textContent=formatDtString(json.starts_at),(elem=document.getElementById("contest-end-time")).textContent=formatDtString(json.ends_at),(elem=document.getElementById("contest-duration")).textContent=getDuration(json.ends_at,json.starts_at)+" | "+getContestStatus(json.ends_at,json.is_frozen)}function setProblemSetMeta(problemSet){var thead=document.querySelector("table.team-list").querySelector("thead tr");for(const problem of problemSet){var html=`<span class='th-problem'>${problem.problem_order_character}</td>`,row=thead.appendChild(document.createElement("th"));row.classList.add("center"),row.classList.add("problem-th"),row.innerHTML=html}$("#max_solv").attr("max",problemSet.length),$("#max_solv").attr("value",problemSet.length),M.updateTextFields()}function populateTeamName(results){var teamNames={};for(const result of results)teamNames[result.fullname]=null;return teamNames}function populateInstitutionName(results){var institutionNames={};for(const result of results)result.institution&&(institutionNames[result.institution.toUpperCase()]=null);return institutionNames}function genUniRank(data){var output={};let i=0;for(const result of data)if(!output[result.institution]){const data={};i+=1,data.uni_rank=i,data.rank=result.rank,data.team_name=result.fullname,data.problem_total_points=result.problem_total_points,data.total_fine=result.total_fine,output[result.institution]=data}return output}function genUniRankTd(unis){var output=[];for(const uni in unis){var data=[];data.push(`<div class="center td_team_rank">${unis[uni].uni_rank}</div>`),data.push(`<div class="center td_team_rank">${unis[uni].rank}</div>`),data.push(`<span class="td_teamName">${uni.toUpperCase()}</span></br><span class="td_inst_name">${unis[uni].team_name}</span>`),data.push(`<div class="center">${unis[uni].problem_total_points}<br>(${unis[uni].total_fine})</div>`),output.push(data)}return output}function relativeTimeDifference(lastUpdate){lastUpdate=new Date-lastUpdate;return Math.round(lastUpdate/6e4)+" minutes ago"}async function init(){M.Collapsible.init($(".collapsible")),M.Modal.init($(".modal")),M.Autocomplete.init($(".autocomplete"),{onAutocomplete:null,limit:10});let data=localStorage.getItem("secret_data"),lastUpdate=0,updateInterval=18e5,refresh=!0;data&&(data=JSON.parse(data),lastUpdate=new Date(data.lastUpdate),data.updateInterval&&(updateInterval=60*data.updateInterval*1e3),refresh=new Date-lastUpdate>updateInterval),refresh&&(resp=await fetch("https://icpc-preliminary-dhaka-2023.kurtnettle.workers.dev/",{method:"GET"}),data=await resp.json(),lastUpdate=new Date(data.lastUpdate),updateInterval=null!=data.updateInterval?data.updateInterval:30,localStorage.setItem("secret_data",JSON.stringify(data))),$("#update_interval").text(relativeTimeDifference(lastUpdate)),setContestMeta(data.contestMeta),setProblemSetMeta(data.contestMeta.problem_set),document.getElementById("last-update-span").textContent=formatDtString(data.contestMeta.updated_at),M.Autocomplete.getInstance($("#team_name")).updateData(populateTeamName(data.teamStats)),M.Autocomplete.getInstance($("#institution_name")).updateData(populateInstitutionName(data.teamStats));var resp=genUniRankTd(genUniRank(data.teamStats));const uniRankTable=$("#uni_rank_tb").DataTable({dom:'p<"chip"i>t',paging:!0,data:resp,autoWidth:!1,pageLength:70,ordering:!1,orderClasses:!1,language:{paginate:{next:'<i class="material-icons blue-text">chevron_right</i>',previous:'<i class="material-icons blue-text">chevron_left</i>'}}});return $("#institution_name_rank").on("keyup change",function(){uniRankTable.draw()}),data.teamStats}
